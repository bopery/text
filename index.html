<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Homies Chat (Invite-only)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#1fb6ff;--muted:#98a2b3;--bubble:#0f172a}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;color:#e6eef6;background:linear-gradient(180deg,#061021 0%, #071428 100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:980px;background:radial-gradient(ellipse at top left, rgba(31,182,255,0.06), transparent 30%), var(--card);border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    .left{width:320px;border-right:1px solid rgba(255,255,255,0.03);padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent)}
    .right{flex:1;padding:18px;display:flex;flex-direction:column;gap:12px}
    .header{display:flex;align-items:center;gap:10px}
    .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c5cff);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021528}
    h1{font-size:16px;margin:0}
    p.muted{color:var(--muted);font-size:13px;margin:6px 0 0}
    .invite{margin-top:18px}

    .card{background:transparent;border-radius:8px;padding:10px}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type=text], input[type=password]{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:rgba(255,255,255,0.02);color:var(--muted);outline:none}
    button{padding:10px 12px;border-radius:8px;border:0;background:var(--accent);color:#021528;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .small{font-size:13px}

    .chat-wrap{display:flex;flex-direction:column;gap:8px;height:640px}
    .messages{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);padding:12px;border-radius:8px;overflow:auto;border:1px solid rgba(255,255,255,0.02)}
    .msg{padding:8px 10px;border-radius:8px;margin-bottom:8px;max-width:78%;word-wrap:break-word}
    .me{background:linear-gradient(90deg, rgba(31,182,255,0.12), rgba(124,92,255,0.08));align-self:flex-end}
    .them{background:rgba(255,255,255,0.02);align-self:flex-start}
    .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
    .input-row{display:flex;gap:8px}
    .input-row input{flex:1}
    .hint{font-size:13px;color:var(--muted)}
    .error{color:#ff7b7b;font-weight:600;margin-top:8px}
    .topbar{display:flex;justify-content:space-between;align-items:center}

    @media (max-width:800px){.app{flex-direction:column}.left{width:100%;border-right:none;border-bottom:1px solid rgba(255,255,255,0.03)}}
  </style>
</head>
<body>
  <div class="app" role="application">
    <div style="display:flex">
      <div class="left">
        <div class="header">
          <div class="logo">H</div>
          <div>
            <h1>Homies Chat</h1>
            <p class="muted">Small invite-only chat — no server required</p>
          </div>
        </div>

        <div class="invite card" id="inviteCard">
          <label for="inviteCode">Enter invite code</label>
          <input id="inviteCode" type="password" placeholder="Type your invite code" aria-label="Invite code" />
          <div style="margin-top:10px;display:flex;gap:8px;">
            <button id="joinBtn">Join</button>
          </div>
          <div id="inviteError" class="error" style="display:none">Wrong invite code — access denied</div>
        </div>

        <div style="margin-top:18px">
          <label for="nickname">Pick a nickname</label>
          <input id="nickname" type="text" placeholder="Your homie name" />
          <div style="margin-top:8px;display:flex;gap:8px;">
            <button id="setName">Set name</button>
            <button class="ghost" id="clearBtn">Clear chat</button>
          </div>
          <div class="hint" style="margin-top:8px">Your nickname is stored locally.
          </div>
        </div>

      </div>
      <div class="right" id="mainArea">
        <div class="topbar">
          <div>
            <strong id="roomLabel">Lobby (invite required)</strong>
            <div class="hint small" id="status">Not connected</div>
          </div>
        </div>

        <div class="chat-wrap">
          <div class="messages" id="messages" aria-live="polite" role="log"></div>

          <div>
            <div class="input-row">
              <input id="textIn" type="text" placeholder="Type a message..." aria-label="Message input" disabled />
              <button id="sendBtn" disabled>Send</button>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>

<script>
(function(){
  const INVITE = 'HIDDEN_CODE'; // exact code required, hidden from users
  const inviteInput = document.getElementById('inviteCode');
  const joinBtn = document.getElementById('joinBtn');
  const inviteError = document.getElementById('inviteError');
  const messagesEl = document.getElementById('messages');
  const textIn = document.getElementById('textIn');
  const sendBtn = document.getElementById('sendBtn');
  const status = document.getElementById('status');
  const setName = document.getElementById('setName');
  const nicknameInput = document.getElementById('nickname');
  const roomLabel = document.getElementById('roomLabel');
  const clearBtn = document.getElementById('clearBtn');

  const KEY_MESSAGES = 'homies_messages_v1';
  const KEY_NICK = 'homies_nickname_v1';
  const KEY_JOINED = 'homies_joined_v1';

  const savedNick = localStorage.getItem(KEY_NICK) || '';
  if (savedNick) nicknameInput.value = savedNick;

  function renderMessages(){
    const raw = localStorage.getItem(KEY_MESSAGES) || '[]';
    let list = [];
    try { list = JSON.parse(raw); } catch(e){ list = [] }
    messagesEl.innerHTML = '';
    list.forEach(msg => {
      const el = document.createElement('div');
      el.className = 'msg ' + (msg.nick === (localStorage.getItem(KEY_NICK)||'') ? 'me' : 'them');
      const meta = document.createElement('div'); meta.className = 'meta'; meta.textContent = msg.nick + ' • ' + new Date(msg.t).toLocaleTimeString();
      const body = document.createElement('div'); body.textContent = msg.text;
      el.appendChild(meta); el.appendChild(body);
      messagesEl.appendChild(el);
    });
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function sendMessage(text){
    if (!text) return;
    const nick = localStorage.getItem(KEY_NICK) || 'Anonymous';
    const raw = localStorage.getItem(KEY_MESSAGES) || '[]';
    let list = [];
    try{ list = JSON.parse(raw) }catch(e){ list = [] }
    const msg = {nick, text, t: Date.now(), id: Math.random().toString(36).slice(2)};
    list.push(msg);
    localStorage.setItem(KEY_MESSAGES, JSON.stringify(list));
    localStorage.setItem('homies_last_event', JSON.stringify({type:'new-msg', id:msg.id, t:Date.now()}));
    renderMessages();
  }

  function joinWithCode(code){
    if (code === INVITE){
      localStorage.setItem(KEY_JOINED,'1');
      inviteError.style.display = 'none';
      textIn.disabled = false; sendBtn.disabled = false; status.textContent = 'Connected (invite accepted)';
      roomLabel.textContent = 'Homies Room';
      renderMessages();
    } else {
      localStorage.removeItem(KEY_JOINED);
      inviteError.style.display = 'block';
      status.textContent = 'Access denied';
      textIn.disabled = true; sendBtn.disabled = true;
    }
  }

  joinBtn.addEventListener('click', ()=>{
    joinWithCode(inviteInput.value.trim());
  });
  inviteInput.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') joinWithCode(inviteInput.value.trim()); });

  sendBtn.addEventListener('click', ()=>{ sendMessage(textIn.value.trim()); textIn.value=''; textIn.focus(); });
  textIn.addEventListener('keydown', (e)=>{ if (e.key === 'Enter') { sendMessage(textIn.value.trim()); textIn.value=''; } });

  setName.addEventListener('click', ()=>{ const name = nicknameInput.value.trim() || 'Anonymous'; localStorage.setItem(KEY_NICK,name); renderMessages(); });

  clearBtn.addEventListener('click', ()=>{
    if (!confirm('Clear ALL messages for everyone in this browser? This cannot be undone.')) return;
    localStorage.setItem(KEY_MESSAGES,'[]');
    localStorage.setItem('homies_last_event', JSON.stringify({type:'clear',t:Date.now()}));
    renderMessages();
  });

  window.addEventListener('storage', (ev)=>{
    if (ev.key === KEY_MESSAGES || ev.key === 'homies_last_event'){
      renderMessages();
    }
  });

  if (localStorage.getItem(KEY_JOINED) === '1'){
    inviteInput.value = INVITE; joinWithCode(INVITE);
  } else {
    status.textContent = 'Invite required';
    renderMessages();
  }

  renderMessages();
})();
</script>
</body>
</html>
